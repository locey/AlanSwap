import React, { useState, useEffect } from 'react';
import BackgroundStars from './BackgroundStars';
import NotificationContainer from './NotificationContainer';
import StatCard from './StatCard';
import EmptyState from './EmptyState';
import { ArrowUpDown, Settings, Info } from './Icons';


const CryptoSwapDEX = () => {
  const [activeTab, setActiveTab] = useState('swap');
  const [walletConnected, setWalletConnected] = useState(false);
  const [fromAmount, setFromAmount] = useState('');
  const [toAmount, setToAmount] = useState('');
  const [fromToken, setFromToken] = useState('ETH');
  const [toToken, setToToken] = useState('USDC');
  const [isSwapping, setIsSwapping] = useState(false);
  const [notifications, setNotifications] = useState([]);

  //add swapSection--yy3
  // const [fromToken, setFromToken] = useState('ETH');
  // const [toToken, setToToken] = useState('USDC');
  // const [fromAmount, setFromAmount] = useState('');
  // const [toAmount, setToAmount] = useState('');
  const [exchangeRate, setExchangeRate] = useState(1250.00);
  const [slippage, setSlippage] = useState('0.5');

  const tokens = [
    { symbol: 'ETH', name: 'Ethereum', balance: 12.345, icon: 'üîπ' },
    { symbol: 'USDC', name: 'USD Coin', balance: 1250.00, icon: 'üíé' },
    { symbol: 'BTC', name: 'Bitcoin', balance: 0.5678, icon: 'üü°' },
    { symbol: 'USDT', name: 'Tether', balance: 500.00, icon: 'üíö' }
  ];

  const getTokenData = (symbol) => {
    return tokens.find(token => token.symbol === symbol);
  };

  const handleSwapTokens = () => {
    setFromToken(toToken);
    setToToken(fromToken);
    setFromAmount(toAmount);
    setToAmount(fromAmount);
  };

  const handleFromAmountChange = (value) => {
    setFromAmount(value);
    if (value && !isNaN(value)) {
      const calculated = fromToken === 'ETH' ? 
        (parseFloat(value) * exchangeRate).toFixed(2) : 
        (parseFloat(value) / exchangeRate).toFixed(6);
      setToAmount(calculated);
    } else {
      setToAmount('');
    }
  };

  const handleMaxClick = () => {
    const tokenData = getTokenData(fromToken);
    if (tokenData) {
      const maxAmount = tokenData.balance.toString();
      setFromAmount(maxAmount);
      handleFromAmountChange(maxAmount);
    }
  };

  // ÁªüËÆ°Êï∞ÊçÆÁä∂ÊÄÅ
  const [stats, setStats] = useState({
    liquidity: 2648.50,
    fees: 45.67,
    pools: 1,
    totalStaked: 3456.78,
    rewards: 123.45,
    apy: 13.7
  });

  // ‰ª£Â∏Å‰ª∑Ê†ºÊï∞ÊçÆ
  const [tokenPrices, setTokenPrices] = useState({
    ETH: { price: 2845, change: 2.34 },
    WBTC: { price: 43200, change: 2.34 },
    USDC: { price: 1.00, change: 0.01 },
    USDT: { price: 1.00, change: 0.01 }
  });

  // ÊòæÁ§∫ÈÄöÁü•
  const showNotification = (message, type = 'info') => {
    const id = Date.now();
    const notification = { id, message, type };
    setNotifications(prev => [...prev, notification]);
    
    setTimeout(() => {
      setNotifications(prev => prev.filter(n => n.id !== id));
    }, 3000);
  };

  // ËøûÊé•Èí±ÂåÖ
  const connectWallet = () => {
    if (!walletConnected) {
      setWalletConnected(true);
      showNotification('Èí±ÂåÖËøûÊé•ÊàêÂäüÔºÅ', 'success');
    }
  };

  // ‰∫§Êç¢‰ª£Â∏Å
  const swapTokens = () => {
    const tempToken = fromToken;
    const tempAmount = fromAmount;
    setFromToken(toToken);
    setToToken(tempToken);
    setFromAmount(toAmount);
    setToAmount(tempAmount);
    showNotification('‰ª£Â∏ÅÂ∑≤‰∫§Êç¢', 'info');
  };

  // ÊâßË°åÂÖëÊç¢
  const executeSwap = async () => {
    if (!walletConnected) {
      connectWallet();
      return;
    }
    
    if (!fromAmount || parseFloat(fromAmount) <= 0) {
      showNotification('ËØ∑ËæìÂÖ•ÂÖëÊç¢Êï∞Èáè', 'error');
      return;
    }

    setIsSwapping(true);
    
    setTimeout(() => {
      setIsSwapping(false);
      setFromAmount('');
      setToAmount('');
      showNotification('ÂÖëÊç¢ÊàêÂäüÂÆåÊàêÔºÅ', 'success');
    }, 2000);
  };

  // ÂÆûÊó∂Ê±áÁéáËÆ°ÁÆó
  useEffect(() => {
    if (fromAmount && fromToken && toToken) {
      const rate = fromToken === 'ETH' ? 2845.32 : 1 / 2845.32;
      const result = (parseFloat(fromAmount) * rate).toFixed(2);
      setToAmount(result);
    } else {
      setToAmount('');
    }
  }, [fromAmount, fromToken, toToken]);  

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white relative overflow-x-hidden">
      <BackgroundStars />
      <NotificationContainer notifications={notifications} />
      
        {/* Â§¥ÈÉ®ÂØºËà™ */}
        <header className="flex flex-col lg:flex-row justify-between items-center mb-4 bg-black p-2">
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg flex items-center justify-center animate-pulse-glow">
              <span className="text-white font-bold animate-spin-slow">‚ö°</span>
            </div>
            <span className="text-xl font-bold neon-text-enhanced animate-bounce-slow">CryptoSwap</span>
          </div>
          <div className="flex bg-slate-800/80 backdrop-blur-lg border border-white/10 rounded-3xl p-1 mb-4 lg:mb-0">
            {[
              { key: 'swap', label: '‰∫§Êç¢', icon: 'üîÑ' },
              { key: 'liquidity', label: 'ÊµÅÂä®ÊÄß', icon: 'üíß' },
              { key: 'mining', label: 'Ë¥®Êäº', icon: 'üìä' },
              { key: 'rewards', label: 'Á©∫Êäï', icon: 'üéÅ' }
            ].map(tab => (
              <button
                key={tab.key}
                onClick={() => setActiveTab(tab.key)}
                className={`px-2 py-1 rounded-2xl font-medium transition-all duration-200 flex items-center gap-2 ${
                  activeTab === tab.key
                    ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white'
                    : 'text-gray-300 hover:text-white hover:bg-white/10'
                }`}
              >
                <span className='text-sm animate-bounce-slow'>{tab.icon}</span>
                <span>{tab.label}</span>
              </button>
            ))}
          </div>

          <div className="flex items-center gap-4">
            <div className="flex items-center bg-green-500/20 border border-green-500/50 rounded-2xl px-2 py-1 text-sm">
              <div className="w-2 h-2 bg-green-400 rounded-full mr-2"></div>
              <span>Ethereum</span>
            </div>
            <button
              onClick={connectWallet}
              className={`font-semibold px-2 py-1 rounded-2xl transition-all duration-200 ${
                walletConnected
                  ? 'bg-green-500/20 border border-green-500/50 text-green-400'
                  : 'bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 hover:-translate-y-1'
              }`}
            >
              {walletConnected ? '0x1234...5678' : 'ËøûÊé•Èí±ÂåÖ'}
            </button>
          </div>
        </header>
      <div className="relative z-10 max-w-6xl mx-auto px-4 py-6">

        <main className='relative z-10'>
          {/* ‰∫§Êç¢ÁïåÈù¢ */}
          {activeTab === 'swap' && (
            <div className="w-full max-w-md mx-auto">
            {/* ‰∫§Êç¢Âç°Áâá */}
            <div className="bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-xl border border-slate-700/50 rounded-2xl p-6 shadow-2xl animate-scale-in">
              {/* Ê†áÈ¢òÂíåËÆæÁΩÆ */}
              <div className="flex items-center justify-between mb-6">
                <div data-slot="card-title" className="text-xl font-bold neon-text-enhanced">‰∫§Êç¢</div>
                <button className="p-2 rounded-lg bg-slate-700/50 hover:bg-slate-700/70 transition-all">
                  <Settings className="w-4 h-4 text-slate-300" />
                </button>
              </div>
      
              {/* ‰ªé Token */}
              <div className="relative mb-4">
                <div className="bg-slate-800/70 rounded-xl p-4 border border-slate-700/30">
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm text-slate-400">‰ªé</span>
                    <span className="text-sm text-slate-400">
                      ‰ΩôÈ¢ù: {getTokenData(fromToken)?.balance.toFixed(fromToken === 'ETH' ? 3 : 2)} {fromToken}
                    </span>
                  </div>
                  <div className="flex items-center gap-3">
                    <select 
                      value={fromToken}
                      onChange={(e) => setFromToken(e.target.value)}
                      className="bg-slate-700 text-white rounded-lg px-3 py-2 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-cyan-500"
                    >
                      {tokens.map(token => (
                        <option key={token.symbol} value={token.symbol}>
                          {token.icon} {token.symbol}
                        </option>
                      ))}
                    </select>
                    <input
                      type="number"
                      value={fromAmount}
                      onChange={(e) => handleFromAmountChange(e.target.value)}
                      placeholder="0.0"
                      className="flex-1 bg-gray-700 py-1 rounded-xl text-white text-right text-xl font-semibold focus:outline-none"
                    />
                    {/* <button 
                      onClick={handleMaxClick}
                      className="text-xs text-cyan-400 hover:text-cyan-300 font-medium bg-cyan-400/10 px-2 py-1 rounded"
                    >MAX</button> */}
                  </div>
                </div>
              </div>
      
              {/* ‰∫§Êç¢ÊåâÈíÆ */}
              <div className="flex justify-center mb-4 relative">
                <button
                  onClick={handleSwapTokens}
                  className="bg-slate-700/50 hover:bg-slate-600/50 p-3 rounded-full border border-slate-600/30 transition-all hover:scale-110"
                >
                  <ArrowUpDown className="w-5 h-5 text-slate-300" />
                </button>
              </div>
      
              {/* Âà∞ Token */}
              <div className="relative mb-6">
                <div className="bg-slate-800/70 rounded-xl p-4 border border-slate-700/30">
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm text-slate-400">Âà∞</span>
                    <span className="text-sm text-slate-400">
                      ‰ΩôÈ¢ù: {getTokenData(toToken)?.balance.toFixed(toToken === 'USDC' ? 2 : 6)} {toToken}
                    </span>
                  </div>
                  <div className="flex items-center gap-3">
                    <select 
                      value={toToken}
                      onChange={(e) => setToToken(e.target.value)}
                      className="bg-slate-700 text-white rounded-lg px-3 py-2 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-cyan-500"
                    >
                      {tokens.map(token => (
                        <option key={token.symbol} value={token.symbol}>
                          {token.icon} {token.symbol}
                        </option>
                      ))}
                    </select>
                    <input
                      type="number"
                      value={toAmount}
                      readOnly
                      placeholder="0.0"
                      className="flex-1 bg-gray-700 py-1 rounded-xl text-white text-right text-xl font-semibold focus:outline-none"
                    />
                  </div>
                </div>
              </div>
      
              {/* ‰∫§Êç¢‰ø°ÊÅØ */}
              <div className="bg-slate-800/30 rounded-xl p-4 mb-6 border border-slate-700/20">
                <div className="flex items-center justify-between text-sm mb-2">
                  <span className="text-slate-400">Ê±áÁéá</span>
                  <span className="text-white">1 {fromToken} ‚âà {exchangeRate.toLocaleString()} {toToken}</span>
                </div>
                <div className="flex items-center justify-between text-sm mb-2">
                  <span className="text-slate-400">ÊªëÁÇπ</span>
                  <span className="text-white">{slippage}%</span>
                </div>
                <div className="flex items-center justify-between text-sm">
                  <span className="text-slate-400">ÊâãÁª≠Ë¥π</span>
                  <span className="text-white">~0.003 ETH</span>
                </div>
              </div>
      
              {/* ‰∫§Êç¢ÊåâÈíÆ */}
              <button 
                disabled={!fromAmount || parseFloat(fromAmount) === 0}
                className="w-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 disabled:from-slate-600 disabled:to-slate-600 text-white font-semibold py-4 px-6 rounded-xl transition-all disabled:cursor-not-allowed"
              >
                {!fromAmount || parseFloat(fromAmount) === 0 ? 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ' : 'Á°ÆËÆ§‰∫§Êç¢'}
              </button>
      
              {/* ÊèêÁ§∫‰ø°ÊÅØ */}
              <div className="flex items-center gap-2 mt-4 p-3 bg-blue-500/10 rounded-lg border border-blue-500/20">
                <Info className="w-4 h-4 text-blue-400 flex-shrink-0" />
                <p className="text-xs text-blue-300">
                  ‰∫§Êç¢ÂâçËØ∑Á°ÆËÆ§‰ª£Â∏ÅÂú∞ÂùÄÂíåÊï∞ÈáèÔºå‰∫§Êòì‰∏ÄÊó¶Á°ÆËÆ§Êó†Ê≥ïÊí§ÈîÄ
                </p>
              </div>
            </div>
      
            {/* Â∏ÇÂú∫Ë∂ãÂäøÂç°Áâá */}
            <div className="bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-xl border border-slate-700/50 rounded-2xl p-6 shadow-2xl mt-6 animate-scale-in">
              <h3 className="text-lg font-semibold text-white mb-4">Â∏ÇÂú∫Ê¶ÇËßà</h3>
              <div className="grid grid-cols-2 gap-4">
                {tokens.slice(0, 4).map((token, index) => (
                  <div key={token.symbol} className="bg-slate-800/50 rounded-lg p-3">
                    <div className="flex items-center gap-2 mb-1">
                      <span className="text-lg">{token.icon}</span>
                      <span className="text-sm font-medium text-white">{token.symbol}</span>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-xs text-slate-400">{token.name}</span>
                      <span className="text-sm font-semibold text-green-400">+2.34%</span>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
          )}

          {/* ÊµÅÂä®ÊÄßÁïåÈù¢ */}
          {activeTab === 'liquidity' && (
            <div className="space-y-8">
              <div className="text-center">
                <h1 className="text-4xl font-bold neon-text mb-2">ÊµÅÂä®ÊÄßÊ±†</h1>
                <p className="text-gray-400 text-lg">Êèê‰æõÊµÅÂä®ÊÄßÔºåËµöÂèñ‰∫§ÊòìÊâãÁª≠Ë¥π</p>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <StatCard title="ÊàëÁöÑÊµÅÂä®ÊÄß" value={stats.liquidity} change="+5.2% Êú¨Âë®" />
                <StatCard title="Á¥ØËÆ°ÊâãÁª≠Ë¥π" value={stats.fees} change="+$0.34 ‰ªäÊó•" />
                <StatCard title="Ê¥ªË∑ÉÊ±†Â≠ê" value={stats.pools} change="ÂÖ± 4 ‰∏™Ê±†Â≠ê" />
              </div>

              <div className="flex justify-center">
                <div className="bg-white/10 rounded-3xl p-1 flex">
                  <button className="px-6 py-1 bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl font-medium">
                    ÊâÄÊúâÊ±†Â≠ê
                  </button>
                  <button className="px-6 py-1 text-gray-300 hover:text-white rounded-2xl font-medium">
                    ÊàëÁöÑÊ±†Â≠ê
                  </button>
                </div>
              </div>

              <EmptyState connectWallet={connectWallet}
                icon="üíß"
                title="ËøûÊé•Èí±ÂåÖÂºÄÂßãÊèê‰æõÊµÅÂä®ÊÄß"
                description="ËøûÊé•ÊÇ®ÁöÑÈí±ÂåÖ‰ª•Ê∑ªÂä†ÊµÅÂä®ÊÄßÂπ∂ËµöÂèñÊâãÁª≠Ë¥π"
              />
            </div>
          )}

          {/* Ë¥®ÊäºÁïåÈù¢ */}
          {activeTab === 'mining' && (
            <div className="space-y-8">
              <div className="text-center">
                <h1 className="text-4xl font-bold neon-text mb-2">Ë¥®ÊäºÊåñÁüø</h1>
                <p className="text-gray-400 text-lg">Ë¥®ÊäºÊÇ®ÁöÑ‰ª£Â∏ÅÔºåËé∑Âæó‰∏∞ÂéöÂ•ñÂä±</p>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <StatCard title="ÊÄªË¥®Êäº‰ª∑ÂÄº" value={stats.totalStaked} change="+12.5% Êú¨Êúà" />
                <StatCard title="Á¥ØËÆ°Â•ñÂä±" value={stats.rewards} change="+$5.67 Êú¨Êó•" />
                <StatCard title="Âπ≥ÂùáAPY" value={`${stats.apy}%`} change="Âπ¥ÂåñÊî∂Áõä" />
              </div>

              <EmptyState connectWallet={connectWallet}
                icon="üîí"
                title="ËøûÊé•Èí±ÂåÖÂºÄÂßãË¥®Êäº"
                description="ËøûÊé•ÊÇ®ÁöÑÈí±ÂåÖ‰ª•Êü•ÁúãÂíåÁÆ°ÁêÜË¥®Êäº"
              />
            </div>
          )}

          {/* Á©∫ÊäïÁïåÈù¢ */}
          {activeTab === 'rewards' && (
            <div className="space-y-8">
              <div className="text-center">
                <h1 className="text-4xl font-bold neon-text mb-2">Á©∫ÊäïÂ•ñÂä±</h1>
                <p className="text-gray-400 text-lg">ÂèÇ‰∏éÊ¥ªÂä®ÔºåËé∑ÂæóÂÖçË¥π‰ª£Â∏ÅÂ•ñÂä±</p>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <StatCard title="ÊÄªÂ•ñÂä±" value="750 CSWAP" change="+150 CSWAP Êú¨Âë®" gradient="from-cyan-400 to-blue-500" />
                <StatCard title="Â∑≤Â•ñÂä±" value="320 CSWAP" change="‰ª∑ÂÄº ~$320" gradient="from-green-400 to-emerald-500" />
                <StatCard title="ÂæÖÈ¢ÜÂèñ" value="400 CSWAP" change="‰ª∑ÂÄº ~$400" gradient="from-purple-400 to-pink-500" />
              </div>

              <div className="flex justify-center mb-8">
                <div className="bg-white/10 rounded-3xl p-1 flex">
                  <button className="px-6 py-1 bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl font-medium">
                    Á©∫ÊäïÊ¥ªÂä®
                  </button>
                  <button className="px-6 py-1 text-gray-300 hover:text-white rounded-2xl font-medium">
                    ‰ªªÂä°‰∏≠ÂøÉ
                  </button>
                </div>
              </div>

              <EmptyState connectWallet={connectWallet}
                icon="üéÅ"
                title="ËøûÊé•Èí±ÂåÖÂèÇ‰∏éÁ©∫Êäï"
                description="ËøûÊé•ÊÇ®ÁöÑÈí±ÂåÖ‰ª•ÂèÇ‰∏éÁ©∫ÊäïÊ¥ªÂä®Âπ∂È¢ÜÂèñÂ•ñÂä±"
              />
            </div>
          )}

        </main>
      </div>

      {/* ÂìÅÁâåÊ†áËØÜ */}
      <div className="fixed bottom-5 right-5 text-xs text-gray-500 z-20">
        üöÄ Made with Manus
      </div>
    </div>
  );
};

export default CryptoSwapDEX;